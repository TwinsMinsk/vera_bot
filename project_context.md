–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ò–ò-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (Context)

–¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π Python-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ aiogram 3.x.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞: –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –ø—Ä–æ–µ–∫—Ç –±–æ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –ó–∞–¥–∞–Ω–∏—è, —Å–ª–µ–¥—É—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ antigravity-kit.

–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å: –ù–µ –ø–∏—à–∏ –≤–µ—Å—å –∫–æ–¥ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ. –†–∞–∑–Ω–æ—Å–∏ –ª–æ–≥–∏–∫—É –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º.

–†–∞–±–æ—Ç–∞ —Å API (OpenRouter) –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∫–ª–∞—Å—Å–µ.

–†–∞–±–æ—Ç–∞ —Å Redis ‚Äî –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∫–ª–∞—Å—Å–µ.

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å: –í—Å–µ I/O –æ–ø–µ—Ä–∞—Ü–∏–∏ (–∑–∞–ø—Ä–æ—Å—ã –∫ API, –ë–î) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å async/await.

–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –¢–æ–∫–µ–Ω—ã –∏ –∫–ª—é—á–∏ –±—Ä–∞—Ç—å –¢–û–õ–¨–ö–û –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (os.getenv).

–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: –ë–æ—Ç –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–∞–¥–∞—Ç—å. –û–±–µ—Ä–Ω–∏ –≤—ã–∑–æ–≤—ã –≤–Ω–µ—à–Ω–∏—Ö API –≤ try/except –∏ –ª–æ–≥–∏—Ä—É–π –æ—à–∏–±–∫–∏.

–î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

–ü–∞–º—è—Ç—å (Redis)

–ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É List –∏–ª–∏ JSON –≤ Redis –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏.
–ö–ª—é—á: chat_history:{user_id}.
–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∏—Å—Ç–æ—Ä–∏–∏: {"role": "user", "content": "..."}.
–õ–æ–≥–∏–∫–∞:

–ü–æ–ª—É—á–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ -> –î–æ–±–∞–≤–∏–ª –≤ Redis (rpush).

–í–∑—è–ª —Å–ª–∞–π—Å –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 10 —Å–æ–æ–±—â–µ–Ω–∏–π (lrange).

–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª –∑–∞–ø—Ä–æ—Å –∫ LLM.

–ü–æ–ª—É—á–∏–ª –æ—Ç–≤–µ—Ç -> –î–æ–±–∞–≤–∏–ª –≤ Redis.

–ï—Å–ª–∏ –¥–ª–∏–Ω–∞ —Å–ø–∏—Å–∫–∞ > 20, —É–¥–∞–ª–∏–ª —Å—Ç–∞—Ä—ã–µ (lpop).

–°–µ—Ä–≤–∏—Å—ã AI (–í–ê–ñ–ù–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï)

1. –¢–µ–∫—Å—Ç–æ–≤—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç (OpenRouter)

–ü—Ä–æ–≤–∞–π–¥–µ—Ä: OpenRouter.

–ú–æ–¥–µ–ª—å: deepseek/deepseek-chat (–¥–µ—à–µ–≤–æ –∏ —É–º–Ω–æ).

–ó–∞–¥–∞—á–∞: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ –∏ –ø—Ä–æ–º–ø—Ç–∞.

2. –ì–æ–ª–æ—Å–æ–≤–æ–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç (Groq) - –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –û–®–ò–ë–ö–ò 405

–ü—Ä–æ–≤–∞–π–¥–µ—Ä: Groq Cloud.

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞: –ò—Å–ø–æ–ª—å–∑—É–π groq (Python SDK) –∏–ª–∏ openai —Å base_url="https://api.groq.com/openai/v1".

–ú–æ–¥–µ–ª—å: whisper-large-v3-turbo (–±—ã—Å—Ç—Ä–∞—è –∏ —Ç–æ—á–Ω–∞—è).

–ö–ª—é—á: –ë—Ä–∞—Ç—å –∏–∑ os.getenv("GROQ_API_KEY").

–õ–æ–≥–∏–∫–∞:

–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª .ogg –æ—Ç Telegram.

–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ .mp3 (—á–µ—Ä–µ–∑ ffmpeg), –µ—Å–ª–∏ API —Ç—Ä–µ–±—É–µ—Ç (Groq –æ–±—ã—á–Ω–æ –ø–æ–Ω–∏–º–∞–µ—Ç, –Ω–æ –ª—É—á—à–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å).

–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Groq API.

–ü–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ ChatService –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ü–µ—Ä—Å–æ–Ω–∞

–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç (System Message) –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–≤—ã–º –≤ —Å–ø–∏—Å–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö –≤ API. –¢–µ–∫—Å—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –±–µ—Ä–∏ –∏–∑ —Ñ–∞–π–ª–∞ persona_prompt.md.

üö® –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è Telegram (–í–ê–ñ–ù–û)

1. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (HTML)

LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Markdown (**bold**, ### Header), –∫–æ—Ç–æ—Ä—ã–π –ª–æ–º–∞–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ Telegram.
–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

–ò—Å–ø–æ–ª—å–∑—É–π parse_mode=ParseMode.HTML –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π.

–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: –ù–∞–ø–∏—à–∏ —É—Ç–∏–ª–∏—Ç—É-—Ö–µ–ª–ø–µ—Ä format_text_html(text: str) -> str:

–ó–∞–º–µ–Ω—è–µ—Ç **text** –Ω–∞ <b>text</b>.

–ó–∞–º–µ–Ω—è–µ—Ç *text* –Ω–∞ <i>text</i>.

–£–¥–∞–ª—è–µ—Ç —Å–∏–º–≤–æ–ª—ã ###, ##.

–≠–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç —Å–∏–º–≤–æ–ª—ã < –∏ >, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —è–≤–ª—è—é—Ç—Å—è —Ç–µ–≥–∞–º–∏.

2. Docker –∏ –°–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—É–¥–∏–æ (.ogg -> .wav/.mp3 –¥–ª—è Whisper) –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ —Å–∏—Å—Ç–µ–º–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ FFmpeg.
–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

Dockerfile: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤—å —É—Å—Ç–∞–Ω–æ–≤–∫—É ffmpeg –≤ –æ–±—Ä–∞–∑:

RUN apt-get update && apt-get install -y ffmpeg


–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: –í –±–ª–æ–∫–µ except —Å–µ—Ä–≤–∏—Å–∞ VoiceService –≤—ã–≤–æ–¥–∏ –≤ –∫–æ–Ω—Å–æ–ª—å (print/logger) –ø–æ–ª–Ω—ã–π traceback, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫.