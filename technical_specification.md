Техническое Задание: Telegram-бот "Верин Помощник"

1. Общее описание

Разработка Telegram-бота на Python для личного использования (пользователь Вера). Бот выступает в роли заботливого, милого помощника с функцией поддержки диалога (память), голосового ввода и поиска информации в интернете.

2. Технологический стек

Язык: Python 3.10+

Фреймворк: aiogram 3.x (асинхронный).

Шаблон: antigravity-kit (структура: handlers, middlewares, services).

LLM Провайдер: OpenRouter API (openai-compatible client).

База данных / Память: Redis (через redis-asyncio). Используется для хранения контекста диалога (последние N сообщений) и FSM состояний.

Голосовые сообщения: OpenAI Whisper (через OpenRouter или Groq API для скорости).

Поиск в интернете: Tavily API или DuckDuckGo Search (бесплатно), либо использование моделей с доступом к сети (Perplexity via OpenRouter).

Хостинг: Railway.

3. Функциональные требования

3.1. Взаимодействие с LLM (Chat)

Бот должен принимать текстовые сообщения.

Сохранять историю переписки (User + Assistant) в Redis (TTL ключа: 24 часа).

При отправке запроса в API, подтягивать последние 10-15 сообщений для сохранения контекста.

Системный промпт: Должен быть настраиваемым (см. файл persona_prompt.md).

3.2. Голосовые сообщения (Voice)

При получении content_type=voice:

Скачать файл во временную папку.

Отправить на транскрибацию (STT) через Whisper.

Полученный текст отправить в LLM как обычное сообщение от пользователя.

Ответить пользователю текстом.

3.3. Поиск в интернете

Реализовать команду или автоматический триггер. Если LLM понимает, что не знает ответа (актуальные новости, погода), она должна сформировать специальный запрос или использовать инструмент поиска.

Реализация: Использовать библиотеку duckduckgo-search для получения сниппетов и скармливания их в контекст LLM.

3.4. Команда /clear

Очистка контекста диалога в Redis, чтобы начать общение "с чистого листа".

4. Требования к UI/UX

Бот реагирует только на конкретный user_id (Веры) или список разрешенных ID (whitelist). Остальным пишет: "Я работаю только для своей хозяйки".

Стиль общения: Поддерживающий, теплый, с использованием ласковых слов.

5. Структура проекта (Antigravity style)

bot.py - точка входа.

app/handlers/ - обработчики (text, voice, commands).

app/services/llm.py - логика общения с OpenRouter.

app/services/voice.py - логика транскрибации.

app/services/memory.py - CRUD операции с Redis.

config.py - чтение .env.